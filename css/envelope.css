/* ============================================
   ENVELOPE — 3D envelope, wax seal, letter card,
   glassmorphism, close button, responsive
   ============================================ */

/* === Envelope Container === */
.envelope-container {
  position: relative;
  width: min(480px, 85vw);
  height: min(340px, 60vw);
  transform-style: preserve-3d;
  opacity: 0;
  transform: translateY(120px) scale(0.8);
  transition: 
    opacity 1.8s var(--ease-silk),
    transform 2s var(--ease-dramatic);
  z-index: var(--z-envelope);
}

.scene.act-envelope .envelope-container {
  opacity: 1;
  transform: translateY(0) scale(1);
}

/* Seal glow hint — gentle pulse to invite click */
.scene.act-envelope .envelope-container .wax-seal {
  animation: sealInvite 2.5s var(--ease-breathe) infinite;
  cursor: pointer;
}

@keyframes sealInvite {
  0%, 100% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0), 0 4px 12px rgba(0,0,0,0.4); }
  50%      { box-shadow: 0 0 24px 6px rgba(255, 215, 0, 0.35), 0 4px 12px rgba(0,0,0,0.4); }
}

/* Push envelope down when letter rises */
.scene.act-letter .envelope-container {
  transform: translateY(min(140px, 18vh)) scale(0.55);
  opacity: 0.15;
  transition: 
    transform 2.5s var(--ease-silk),
    opacity 2.5s var(--ease-silk);
}

/* === Envelope Body === */
.envelope {
  position: relative;
  width: 100%;
  height: 100%;
  transform-style: preserve-3d;
}

.envelope__body {
  position: absolute;
  inset: 0;
  background: var(--envelope-body);
  border-radius: 8px;
  box-shadow:
    0 20px 80px var(--envelope-shadow),
    0 8px 30px rgba(0, 0, 0, 0.3),
    inset 0 1px 0 rgba(255, 255, 255, 0.3);
  overflow: hidden;
}

/* Inner liner */
.envelope__body::before {
  content: '';
  position: absolute;
  inset: 6px;
  background: var(--envelope-liner);
  border-radius: 4px;
  opacity: 0;
  transition: opacity 1s var(--ease-silk) 0.5s;
}

.scene.act-open .envelope__body::before {
  opacity: 0.6;
}

/* Paper texture */
.envelope__body::after {
  content: '';
  position: absolute;
  inset: 0;
  background-image: 
    repeating-linear-gradient(
      0deg, transparent, transparent 2px,
      rgba(0,0,0,0.01) 2px, rgba(0,0,0,0.01) 4px
    );
  border-radius: 8px;
  pointer-events: none;
}

/* === Envelope Flap === */
.envelope__flap {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 60%;
  background: var(--envelope-flap);
  clip-path: polygon(0 0, 50% 100%, 100% 0);
  transform-origin: top center;
  transform: rotateX(0deg);
  transform-style: preserve-3d;
  backface-visibility: hidden;
  z-index: 3;
  transition: transform var(--duration-flap) var(--ease-dramatic);
  box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.envelope__flap::after {
  content: '';
  position: absolute;
  inset: 0;
  background: linear-gradient(180deg, #d4b896 0%, #c9a882 100%);
  clip-path: polygon(0 0, 50% 100%, 100% 0);
  transform: rotateX(180deg);
  backface-visibility: hidden;
}

.scene.act-open .envelope__flap {
  transform: rotateX(-180deg);
}

/* === Wax Seal === */
.wax-seal {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 76px;
  height: 76px;
  border-radius: 50%;
  z-index: 10;
  transition: 
    transform 0.6s var(--ease-bounce),
    opacity 0.5s ease;
}

.wax-seal__body {
  width: 100%;
  height: 100%;
  border-radius: 50%;
  background: radial-gradient(
    circle at 38% 35%,
    var(--wax-bright) 0%,
    var(--wax-main) 40%,
    var(--wax-dark) 100%
  );
  box-shadow:
    inset 0 -3px 6px rgba(0, 0, 0, 0.4),
    inset 0 3px 6px var(--wax-shine),
    0 4px 12px rgba(0, 0, 0, 0.4),
    0 0 0 2px rgba(92, 16, 16, 0.3);
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  overflow: hidden;
}

.wax-seal__body::before {
  content: '';
  position: absolute;
  top: -5px;
  right: -7px;
  width: 22px;
  height: 18px;
  background: var(--wax-main);
  border-radius: 50%;
  opacity: 0.7;
}

.wax-seal__body::after {
  content: '';
  position: absolute;
  bottom: -4px;
  left: -5px;
  width: 17px;
  height: 14px;
  background: var(--wax-dark);
  border-radius: 50%;
  opacity: 0.5;
}

.wax-seal__icon {
  font-size: 26px;
  color: rgba(255, 200, 200, 0.6);
  text-shadow: 
    0 1px 2px rgba(0,0,0,0.3),
    0 -1px 1px rgba(255,255,255,0.1);
  z-index: 1;
  position: relative;
}

/* Seal break */
.scene.act-seal-break .wax-seal {
  transform: translate(-50%, -50%) scale(1.3) rotate(15deg);
  opacity: 0;
  pointer-events: none;
}

/* Seal restored after close */
.wax-seal.is-restored {
  transform: translate(-50%, -50%) scale(0);
  opacity: 0;
  animation: sealRestore 0.8s var(--ease-bounce) 0.6s forwards !important;
}

@keyframes sealRestore {
  0%   { transform: translate(-50%, -50%) scale(0); opacity: 0; }
  60%  { transform: translate(-50%, -50%) scale(1.15); opacity: 1; }
  100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
}

/* === Letter Card === */
.letter {
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -30%) scale(0.8);
  width: min(400px, 82vw);
  min-height: auto;
  padding: 48px 36px;
  z-index: var(--z-letter);
  opacity: 0;
  pointer-events: none;

  /* Glassmorphism */
  background: var(--glass-bg);
  backdrop-filter: blur(24px) saturate(1.3);
  -webkit-backdrop-filter: blur(24px) saturate(1.3);
  border: 1px solid var(--glass-border);
  border-radius: 14px;
  box-shadow:
    0 24px 90px rgba(0, 0, 0, 0.45),
    0 0 1px rgba(212, 165, 116, 0.3),
    inset 0 1px 0 var(--glass-shine),
    inset 0 -1px 0 rgba(0, 0, 0, 0.1);
  
  transition: 
    opacity 1.8s var(--ease-silk),
    transform 2.5s var(--ease-dramatic);
}

.scene.act-letter .letter {
  opacity: 1;
  transform: translate(-50%, -50%) scale(1);
  pointer-events: auto;
}

/* Glow behind letter */
.letter::before {
  content: '';
  position: absolute;
  inset: -50px;
  background: radial-gradient(
    ellipse at center,
    rgba(212, 165, 116, 0.08) 0%,
    transparent 70%
  );
  z-index: -1;
  animation: letterGlow 4s var(--ease-breathe) infinite alternate;
  border-radius: 50%;
}

@keyframes letterGlow {
  0%   { opacity: 0.4; transform: scale(1); }
  100% { opacity: 0.8; transform: scale(1.15); }
}

/* === Close Button === */
.letter__close {
  position: absolute;
  top: 14px;
  right: 14px;
  width: 34px;
  height: 34px;
  border: 1px solid rgba(212, 165, 116, 0.3);
  border-radius: 50%;
  background: rgba(212, 165, 116, 0.06);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  z-index: 10;
  opacity: 0;
  transform: scale(0.5) rotate(-90deg);
  transition: 
    opacity 0.6s var(--ease-silk),
    transform 0.6s var(--ease-bounce),
    background 0.3s ease,
    border-color 0.3s ease;
}

.letter__close:hover {
  background: rgba(212, 165, 116, 0.15);
  border-color: rgba(212, 165, 116, 0.6);
  opacity: 1 !important;
}

.letter__close.is-visible {
  opacity: 0.5;
  transform: scale(1) rotate(0deg);
}

.letter__close-icon {
  font-size: 14px;
  color: var(--gold);
  line-height: 1;
  font-family: 'Cormorant Garamond', serif;
  font-weight: 300;
}

/* === Corner Ornaments === */
.letter__corner {
  position: absolute;
  width: 28px;
  height: 28px;
}

.letter__corner::before,
.letter__corner::after {
  content: '';
  position: absolute;
  background: var(--gold);
  opacity: 0.5;
}

.letter__corner::before { width: 100%; height: 1px; }
.letter__corner::after  { width: 1px; height: 100%; }

.letter__corner--tl { top: 14px; left: 14px; }
.letter__corner--tl::before { top: 0; left: 0; }
.letter__corner--tl::after  { top: 0; left: 0; }

.letter__corner--tr { top: 14px; right: 14px; }
.letter__corner--tr::before { top: 0; right: 0; }
.letter__corner--tr::after  { top: 0; right: 0; }

.letter__corner--bl { bottom: 14px; left: 14px; }
.letter__corner--bl::before { bottom: 0; left: 0; }
.letter__corner--bl::after  { bottom: 0; left: 0; }

.letter__corner--br { bottom: 14px; right: 14px; }
.letter__corner--br::before { bottom: 0; right: 0; }
.letter__corner--br::after  { bottom: 0; right: 0; }

/* Inner frame */
.letter__inner-frame {
  position: absolute;
  inset: 20px;
  border: 1px solid rgba(212, 165, 116, 0.12);
  border-radius: 8px;
  pointer-events: none;
}

/* === Letter Content === */
.letter__content {
  position: relative;
  text-align: center;
  z-index: 1;
}

.letter__divider {
  margin: 22px auto;
  height: 1px;
  width: 0;
  background: linear-gradient(90deg, transparent, var(--gold), transparent);
  transition: width 1.2s var(--ease-silk);
}

.letter__divider.is-visible {
  width: 75%;
}

.letter__footer {
  margin-top: 28px;
  font-size: 15px;
  letter-spacing: 14px;
  color: var(--rose);
  opacity: 0;
  transform: translateY(10px);
  transition: 
    opacity 1s var(--ease-silk),
    transform 1s var(--ease-silk);
}

.letter__footer.is-visible {
  opacity: 0.6;
  transform: translateY(0);
}

/* === Signature === */
.letter__signature {
  margin-top: 18px;
  font-family: 'Great Vibes', cursive;
  font-size: clamp(16px, 3.5vw, 21px);
  text-align: right;
  color: var(--rose-gold);
  opacity: 0;
  transform: translateY(8px);
  transition:
    opacity 1.2s var(--ease-silk),
    transform 1s var(--ease-silk);
  text-shadow: 0 0 14px rgba(232,180,184,0.25);
  letter-spacing: 0.5px;
  padding-right: 8px;
}

.letter__signature.is-visible {
  opacity: 0.75;
  transform: translateY(0);
}

/* === Click Hint === */
.envelope__hint {
  position: absolute;
  bottom: -44px;
  left: 50%;
  transform: translateX(-50%);
  font-family: 'Cormorant Garamond', serif;
  font-size: 18px;
  font-style: italic;
  color: var(--gold);
  opacity: 0;
  white-space: nowrap;
  pointer-events: none;
  transition: opacity 0.8s var(--ease-silk);
}

.scene.act-envelope .envelope__hint {
  opacity: 0;
  animation: hintPulse 3s var(--ease-breathe) 1s infinite;
}

.scene.act-seal-break .envelope__hint,
.scene.act-open .envelope__hint {
  opacity: 0 !important;
  animation: none;
}

@keyframes hintPulse {
  0%, 100% { opacity: 0.25; }
  50%      { opacity: 0.65; }
}

/* ==========================================
   RESPONSIVE
   ========================================== */

/* Large desktop */
@media (min-width: 1200px) {
  .envelope-container { width: 540px; height: 380px; }
  .wax-seal { width: 86px; height: 86px; }
  .wax-seal__icon { font-size: 30px; }
  .letter { width: 440px; min-height: auto; padding: 52px 40px; }
}

/* Tablet landscape */
@media (max-width: 1024px) and (min-width: 769px) {
  .envelope-container { width: 460px; height: 320px; }
  .letter { width: 400px; min-height: auto; padding: 44px 34px; }
}

/* Tablet portrait */
@media (max-width: 768px) {
  .envelope-container { width: min(420px, 82vw); height: min(295px, 54vw); }
  .letter { width: min(370px, 84vw); min-height: auto; padding: 40px 28px; }
  .wax-seal { width: 70px; height: 70px; }
  .wax-seal__icon { font-size: 24px; }
}

/* Large phones */
@media (max-width: 480px) {
  .envelope-container { width: min(360px, 90vw); height: min(250px, 60vw); }
  .letter { 
    width: min(330px, 90vw); 
    min-height: auto; 
    padding: 36px 22px; 
  }
  .wax-seal { width: 62px; height: 62px; }
  .wax-seal__icon { font-size: 22px; }
  .letter__corner { width: 20px; height: 20px; }
  .envelope__hint { font-size: 18px; bottom: -34px; }
  .letter__close { width: 30px; height: 30px; top: 10px; right: 10px; }
}

/* Small phones */
@media (max-width: 360px) {
  .envelope-container { width: 92vw; height: 62vw; }
  .letter { 
    width: 92vw; 
    min-height: auto; 
    padding: 30px 18px; 
  }
  .wax-seal { width: 54px; height: 54px; }
  .wax-seal__icon { font-size: 18px; }
}

/* Short viewport (landscape phones) */
@media (max-height: 500px) {
  .envelope-container { width: min(340px, 52vw); height: min(230px, 38vh); }
  .letter {
    width: min(320px, 54vw);
    min-height: auto;
    padding: 22px 16px;
  }
  .scene.act-letter .envelope-container {
    transform: translateY(70px) scale(0.4);
    opacity: 0.1;
  }
}

@media (max-height: 600px) and (min-height: 501px) {
  .scene.act-letter .envelope-container {
    transform: translateY(100px) scale(0.5);
    opacity: 0.12;
  }
  .letter { min-height: auto; }
}
